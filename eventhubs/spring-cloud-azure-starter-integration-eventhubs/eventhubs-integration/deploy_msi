# https://docs.microsoft.com/en-us/azure/spring-cloud/quickstart-deploy-apps?tabs=Azure-CLI&pivots=programming-language-java


az configure --defaults group=rg-servicebusapp-bwmkg spring-cloud=asc-sn-gzh-service

az extension update --name spring-cloud
# create spring-cloud 5 minutes
az spring-cloud create -n asc-sn-gzh-service -g rg-servicebusapp-bwmkg
# create spring-cloud app
az spring-cloud app create -n asc-sn-gzh-app-ehintgration -s asc-sn-gzh-service -g rg-servicebusapp-bwmkg --assign-identity
# az spring-cloud app create -n asc-sn-gzh-app-ehintgration-key -s asc-sn-gzh-service -g rg-servicebusapp-bwmkg --assign-identity
az spring-cloud app identity assign -n asc-sn-gzh-app-ehintgration -s asc-sn-gzh-service -g rg-servicebusapp-bwmkg
# show identity info
az spring-cloud app identity show -n asc-sn-gzh-app-ehintgration -s asc-sn-gzh-service -g rg-servicebusapp-bwmkg

 "principalId": "6397842b-4770-46bf-9b9e-242c14e6cc49",



## ENV
AZURE_STORAGE_ACCOUNT=stblobjiqqk STORAGE_CONTAINER_NAME=blobcontainer

az role assignment create --assignee "f1c01d8b-a2bb-4a9c-92d7-ff65abd65827" \
--role "Storage Blob Data Contributor" \
--resource-group


AZURE_EVENTHUBS_NAMESPACE=ehn-eh-integration-tyaeb \
AZURE_STORAGE_ACCOUNT_NAME=stehintegrationeycbr \
AZURE_STORAGE_CONTAINER_NAME=eventhubs-integration-sample \
// rg-eh-integration-ngxgk

# deploy
 az spring-cloud app deploy --env AZURE_EVENTHUBS_NAMESPACE=ehn-eh-integration-tyaeb \
                                  AZURE_STORAGE_ACCOUNT_NAME=stehintegrationeycbr \
                                  AZURE_STORAGE_CONTAINER_NAME=eventhubs-integration-sample \
 --name asc-sn-gzh-app-ehintgration \
 --artifact-path ./target/spring-cloud-azure-starter-integration-sample-eventhubs-1.0.0.jar \
 --jvm-options="-Xms1024m -Xmx1024m"


# log
az spring-cloud app logs --name asc-sn-gzh-app-ehintgration \
                         --resource-group rg-servicebusapp-bwmkg \
                         --service asc-sn-gzh-service \
                         --follow

## result
# 如果用msi, 会不会慢;
curl -X POST https://asc-sn-gzh-service-asc-sn-gzh-app-ehintgration.azuremicroservices.io/messages?message=hello


log from asc
```
works,but too much time;

```


## deploy with App Service
```
az webapp deploy --resource-group rg-app-service-gzh --name asc-sn-gzh-app-ehintgration --src-path ./target/spring-cloud-azure-starter-integration-sample-eventhubs-1.0.0.jar --type jar

```

### log
//az webapp log deployment show  --name asc-sn-gzh-app-ehintgration  --resource-group rg-app-service-gzh
az webapp log tail --name asc-sn-gzh-app-ehintgration --resource-group rg-app-service-gzh

curl -X POST https://asc-sn-gzh-app-ehintgration.azurewebsites.net/messages?message=hello


tenantId: 72f988bf-86f1-41af-91ab-2d7cd011db47
client-id: 07f86dcc-41b8-4216-af64-fd23bb59cfc1
client-secret: c2U7Q~Ii9vLAFH9LBT6n3qvCY~t.b1s8oR819